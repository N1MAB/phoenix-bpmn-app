# ==========================================
# BEVEILIGDE DIAGRAM TOOL - .htaccess
# ==========================================

# Basis beveiliging
Options -Indexes
Options -MultiViews
ServerSignature Off

# Security Headers
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

# Content Security Policy (aanpassen naar jouw domein)
Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' https://n8n.io https://*.n8n.cloud;"

# Forceer HTTPS (uncomment als je SSL hebt)
# RewriteEngine On
# RewriteCond %{HTTPS} !=on
# RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# Blokkeer directe toegang tot assets
<FilesMatch "\.(js|css)$">
    <IfModule mod_headers.c>
        Header set Cache-Control "private, max-age=31536000"
    </IfModule>
</FilesMatch>

# Blokkeer hotlinking van belangrijke resources
RewriteEngine on
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?slimpunt\.nl [NC]
RewriteRule \.(js|css|svg|png|jpg|jpeg|gif)$ - [F,NC,L]

# Bescherm tegen bekend kwaadaardig verkeer
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_USER_AGENT} ^.*(crawler|spider|bot|scraper|wget|curl|python).* [NC]
    RewriteRule .* - [F,L]
</IfModule>

# Compressie voor betere performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Disable server info
<IfModule mod_headers.c>
    Header unset Server
    Header unset X-Powered-By
</IfModule>

# Rate limiting (voorkom brute force)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} ^(POST|PUT|DELETE)
    RewriteCond %{REQUEST_URI} ^/api/ [OR]
    RewriteCond %{REQUEST_URI} ^/webhook/
    RewriteRule .* - [E=RATE_LIMIT:1]
</IfModule>

# Blokkeer toegang tot gevoelige bestanden
<FilesMatch "^\.|(package\.json|package-lock\.json|\.env|\.git|README\.md|DEPLOYMENT\.md)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Eigen error pages
ErrorDocument 403 "Access Denied"
ErrorDocument 404 "Page Not Found"
ErrorDocument 500 "Internal Server Error"